{
  "file_path": "SPECS/SIB/INTENT/TASK_ARCHIVE/111_C3_tkhd_Track_Header_Parser/C3_tkhd_Track_Header_Parser.md",
  "n_spec": 10,
  "n_func": 8,
  "intent_atoms": [
    {
      "type": "user_story",
      "description": "Implement a parser for the tkhd (track header) box that extracts flag-dependent fields, duration, transformation matrix, and presentation dimensions for display across ISOInspector surfaces.",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "Support both version 0 and 1 layouts, honoring flag-driven optional fields such as duration and alternate_group.",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "Decode track and movie times (creation_time, modification_time, track_id, duration) using the correct bit widths per version.",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "Parse layer, alternate group, volume, and 3x3 transformation matrix values with fixed-point conversion consistent with PRD specifications.",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "Expose width and height fields as 16.16 fixed-point dimensions and flag zero-sized tracks for validation follow-up.",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "Add unit tests covering standard video and audio fixtures, including disabled tracks and zero-duration edge cases.",
      "source_line": null
    },
    {
      "type": "architectural_decision",
      "description": "Reuse FullBoxReader to handle version/flags extraction before parsing payload fields.",
      "source_line": null
    },
    {
      "type": "architectural_decision",
      "description": "Reference the mvhd parser for fixed-point math helpers to maintain consistent scaling for rate, volume, matrix elements.",
      "source_line": null
    },
    {
      "type": "architectural_decision",
      "description": "Extend BoxParserRegistry with a tkhd entry that wires parsed values into detail view models and JSON export structures.",
      "source_line": null
    },
    {
      "type": "invariant",
      "description": "Track header fields must be decoded according to the version specified in the box.",
      "source_line": null
    }
  ],
  "functional_units": [
    {
      "name": "tkhd Box Parser",
      "description": "Parses the tkhd track header box extracting all fields based on version and flags",
      "source_line": null
    },
    {
      "name": "FullBoxReader Integration",
      "description": "Uses FullBoxReader to read version and flags before payload parsing",
      "source_line": null
    },
    {
      "name": "Versioned Timeline Field Decoder",
      "description": "Decodes creation_time, modification_time, track_id, duration with correct bit widths for v0 and v1",
      "source_line": null
    },
    {
      "name": "Optional Field Handling",
      "description": "Handles flag-driven optional fields such as duration and alternate_group",
      "source_line": null
    },
    {
      "name": "Layer/Group Metadata Parser",
      "description": "Parses layer, alternate group, volume and 3x3 transformation matrix values with fixed-point conversion",
      "source_line": null
    },
    {
      "name": "Fixed-Point Dimension Extractor",
      "description": "Extracts width and height as 16.16 fixed-point dimensions and validates zero-sized tracks",
      "source_line": null
    },
    {
      "name": "BoxParserRegistry Extension",
      "description": "Registers tkhd parser entry in BoxParserRegistry to wire parsed data into view models and JSON export",
      "source_line": null
    },
    {
      "name": "Unit Test Suite for tkhd",
      "description": "Provides tests covering standard video/audio fixtures, disabled tracks, zero-duration edge cases",
      "source_line": null
    }
  ],
  "metadata": {
    "file_size_bytes": 2582,
    "line_count": 43
  }
}
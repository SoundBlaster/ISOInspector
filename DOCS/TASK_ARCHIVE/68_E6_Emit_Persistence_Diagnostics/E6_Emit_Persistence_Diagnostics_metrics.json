{
  "file_path": "SPECS/SIB/INTENT/TASK_ARCHIVE/68_E6_Emit_Persistence_Diagnostics/E6_Emit_Persistence_Diagnostics.md",
  "n_spec": 8,
  "n_func": 3,
  "intent_atoms": [
    {
      "type": "user_story",
      "description": "Instrument session and recents persistence flows to surface failures through shared diagnostics logging pipeline.",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "Persistence failures in DocumentSessionController.persistRecents() and persistSession() emit errors via DiagnosticsLogger with metadata (file URL, session identifier).",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "QA automation simulates recents/session write failures and asserts diagnostics entries are produced without crashing the app shell.",
      "source_line": null
    },
    {
      "type": "acceptance_criteria",
      "description": "User-facing behavior remains unchanged when persistence succeeds: recents and session state still save/restore via existing CoreData and JSON stores.",
      "source_line": null
    },
    {
      "type": "invariant",
      "description": "Diagnostics emission must compile cross-platform (macOS/iOS/iPadOS) without os.log availability, following DiagnosticsLogger conditional compilation pattern.",
      "source_line": null
    },
    {
      "type": "architectural_decision",
      "description": "Replace @todo markers in DocumentSessionController with concrete logging using shared diagnostics subsystem instead of ad-hoc print calls.",
      "source_line": null
    },
    {
      "type": "architectural_decision",
      "description": "Capture contextual metadata (workspace/session IDs, failing file URLs) in logged messages for telemetry dashboards and CLI/app smoke tests.",
      "source_line": null
    },
    {
      "type": "architectural_decision",
      "description": "Extend test coverage to inject failing RecentsStore / WorkspaceSessionStore collaborators and validate diagnostics emission without persisting partial state.",
      "source_line": null
    }
  ],
  "functional_units": [
    {
      "name": "Diagnostics Logging for Persistence Failures",
      "description": "Logs errors from DocumentSessionController.persistRecents() and persistSession() via DiagnosticsLogger with metadata such as file URL and session identifier.",
      "source_line": null
    },
    {
      "name": "Simulated Failure Testing for Recents/Session Persistence",
      "description": "Unit/integration tests that inject failing RecentsStore or WorkspaceSessionStore to verify diagnostics emission without crashing the app.",
      "source_line": null
    },
    {
      "name": "Cross-Platform Diagnostics Helper Extension",
      "description": "Adds diagnostics helpers compatible with macOS/iOS/iPadOS, using conditional compilation to avoid os.log dependency.",
      "source_line": null
    }
  ],
  "metadata": {
    "file_size_bytes": 3083,
    "line_count": 39
  }
}